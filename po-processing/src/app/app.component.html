<router-outlet></router-outlet>

<div class="container-fluid">
  <h1>PO Processing</h1>
  <div class="row">
    <app-warehouse-form
      (submitEvent)="warehouseLotsBySku$.next($event)"
      class="col-6"
    ></app-warehouse-form>
    <div class="col-6">
      Preview:<br />
      <ul class="preview">
        <li *ngFor="let item of warehouseLotsBySku$ | async | keyvalue">
          <b>{{ item.key }}:</b>
          <ul>
            <li *ngFor="let lot of item.value">
              Lot {{ lot.lotId }}: {{ lot.availableQty }}
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <hr />

  <app-po-form></app-po-form>

  <hr />
  <button
    type="button"
    class="btn btn-success"
    (click)="getOutboundQtyPerLot()"
  >
    Auto select lot
  </button>
  <div class="row">
    <div class="col-6">
      <h4>Result</h4>
      <div *ngFor="let sku of outboundResult | keyvalue">
        <b>Item {{ sku.key }}:</b>
        <ul>
          <li *ngFor="let lot of sku.value.qtyPerLot | keyvalue">
            Taken from Lot {{ lot.key }}: {{ lot.value }}
          </li>
          <li *ngIf="sku.value.remaining > 0" class="text-danger">
            <strong
              >This SKU still needs {{ sku.value.remaining }} more
              {{ sku.value.remaining === 1 ? 'item' : 'items' }}</strong
            >
          </li>
        </ul>
      </div>
    </div>
    <div class="col-6" *ngIf="outboundResult">
      <h4>Excel-friendly View</h4>
      <code>
        <div *ngFor="let sku of outboundResult | keyvalue">
          <div
            *ngFor="let lot of sku.value.qtyPerLot | keyvalue"
            [class.text-success]="sku.value.remaining === 0"
          >
            {{ sku.key }},{{ lot.key }},{{ lot.value }}
          </div>
        </div>
      </code>
    </div>
  </div>
</div>
